<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>scran_markers: Marker detection for groups of cells</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">scran_markers
   </div>
   <div id="projectbrief">Marker detection for single-cell data</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Marker detection for groups of cells </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/libscran/scran_markers/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/scran_markers/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/libscran/scran_markers"><img src="https://codecov.io/gh/libscran/scran_markers/graph/badge.svg?token=iL6GuHkCjz" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This library contains functions for detecting group-specific markers (e.g., for clusters or cell types) from a single-cell expression matrix. It performs differential analyses between pairs of groups, computing a variety of effect sizes like Cohen's d and the AUC. The effect sizes are then summarized for each group to obtain some rankings for prioritizing interesting genes. The code itself was originally derived from the <a href="https://bioconductor.org/packages/scran"><b>scran</b> R package</a>, factored out into a separate C++ library for easier re-use.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>Given a <a href="https://github.com/tatami-inc/tatami"><code>tatami::Matrix</code></a> and an array of group assignments, the <code>score_markers_summary()</code> function will compute the aggregate statistics across all genes for each group.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="scran__markers_8hpp.html">scran_markers/scran_markers.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Expression matrix, usually log-normalized.</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_classRef" href="https://tatami-inc.github.io/tatami/classtatami_1_1Matrix.html">tatami::Matrix&lt;double, int&gt;</a>&amp; matrix = some_data_source();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Array containing integer assignments to groups 0, 1, 2, etc.</span></div>
<div class="line">std::vector&lt;int&gt; groupings = some_groupings();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structscran__markers_1_1ScoreMarkersSummaryOptions.html">scran_markers::ScoreMarkersSummaryOptions</a> opt;</div>
<div class="line"><span class="keyword">auto</span> res = <a class="code hl_function" href="namespacescran__markers.html#a92c28687f963fbe5535e3fc0c4a60a80">scran_markers::score_markers_summary</a>(matrix, groupings.data(), opt);</div>
<div class="line"> </div>
<div class="line">res.mean[0]; <span class="comment">// mean of each gene in the first group.</span></div>
<div class="line">res.detected[0]; <span class="comment">// detected proportion of each gene in the first group.</span></div>
<div class="ttc" id="aclasstatami_1_1Matrix_html"><div class="ttname"><a href="https://tatami-inc.github.io/tatami/classtatami_1_1Matrix.html">tatami::Matrix</a></div></div>
<div class="ttc" id="anamespacescran__markers_html_a92c28687f963fbe5535e3fc0c4a60a80"><div class="ttname"><a href="namespacescran__markers.html#a92c28687f963fbe5535e3fc0c4a60a80">scran_markers::score_markers_summary</a></div><div class="ttdeci">void score_markers_summary(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;matrix, const Group_ *const group, const ScoreMarkersSummaryOptions &amp;options, const ScoreMarkersSummaryBuffers&lt; Stat_, Rank_ &gt; &amp;output)</div><div class="ttdef"><b>Definition</b> score_markers_summary.hpp:749</div></div>
<div class="ttc" id="ascran__markers_8hpp_html"><div class="ttname"><a href="scran__markers_8hpp.html">scran_markers.hpp</a></div><div class="ttdoc">Marker detection for single-cell data.</div></div>
<div class="ttc" id="astructscran__markers_1_1ScoreMarkersSummaryOptions_html"><div class="ttname"><a href="structscran__markers_1_1ScoreMarkersSummaryOptions.html">scran_markers::ScoreMarkersSummaryOptions</a></div><div class="ttdoc">Options for score_markers_summary() and friends.</div><div class="ttdef"><b>Definition</b> score_markers_summary.hpp:31</div></div>
</div><!-- fragment --><p>The most interesting part of this result is the effect size summary for each group. For each group, we compute the Cohen's d, AUC, delta-mean and delta-detected by comparing that group against every other group. We then combine the effect sizes from all comparisons into some summary statistics like the mean or median. Ranking by these summaries yields a list of potential group-specific marker genes for further examination. Picking a different summary statistic and/or effect size will favor different types of markers in the ranking.</p>
<div class="fragment"><div class="line">res.cohens_d[0].mean; <span class="comment">// mean Cohen&#39;s d across all genes for the first group</span></div>
<div class="line">res.auc[0].median; <span class="comment">// median AUC across all genes for the first group.</span></div>
</div><!-- fragment --><p>If the dataset contains some uninteresting variation (e.g., batches, samples), we can ensure that it does not affect the effect size calculation by blocking on that factor. This performs the comparisons within each level of the blocking factor so as to ignore the irrelevant variation.</p>
<div class="fragment"><div class="line"><span class="comment">// Array containing integer assignments to blocks 0, 1, 2, etc.</span></div>
<div class="line">std::vector&lt;int&gt; blocks = some_blocks();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> block_res = <a class="code hl_function" href="namespacescran__markers.html#ab817d3509bf11224c5841cee6eb19d26">scran_markers::score_markers_summary_blocked</a>(</div>
<div class="line">    matrix,</div>
<div class="line">    groupings.data(), </div>
<div class="line">    blocks.data(),</div>
<div class="line">    opt</div>
<div class="line">);</div>
<div class="ttc" id="anamespacescran__markers_html_ab817d3509bf11224c5841cee6eb19d26"><div class="ttname"><a href="namespacescran__markers.html#ab817d3509bf11224c5841cee6eb19d26">scran_markers::score_markers_summary_blocked</a></div><div class="ttdeci">void score_markers_summary_blocked(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;matrix, const Group_ *const group, const Block_ *const block, const ScoreMarkersSummaryOptions &amp;options, const ScoreMarkersSummaryBuffers&lt; Stat_, Rank_ &gt; &amp;output)</div><div class="ttdef"><b>Definition</b> score_markers_summary.hpp:802</div></div>
</div><!-- fragment --><p>If more detail is necessary, we can obtain effect sizes from all pairwise comparisons using the <code>score_markers_pairwise()</code> function.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structscran__markers_1_1ScoreMarkersPairwiseOptions.html">scran_markers::ScoreMarkersPairwiseOptions</a> popt;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> pair_res = <a class="code hl_function" href="namespacescran__markers.html#a6c63a08774d6f2105b68b656f8a3da94">scran_markers::score_markers_pairwise</a>(</div>
<div class="line">    matrix,</div>
<div class="line">    groupings.data(),</div>
<div class="line">    popt</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3D arrays of effect sizes for each pairwise comparison and gene.</span></div>
<div class="line">pair_res.cohens_d;</div>
<div class="line">pair_res.auc; </div>
<div class="ttc" id="anamespacescran__markers_html_a6c63a08774d6f2105b68b656f8a3da94"><div class="ttname"><a href="namespacescran__markers.html#a6c63a08774d6f2105b68b656f8a3da94">scran_markers::score_markers_pairwise</a></div><div class="ttdeci">void score_markers_pairwise(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;matrix, const Group_ *const group, const ScoreMarkersPairwiseOptions &amp;options, const ScoreMarkersPairwiseBuffers&lt; Stat_ &gt; &amp;output)</div><div class="ttdef"><b>Definition</b> score_markers_pairwise.hpp:519</div></div>
<div class="ttc" id="astructscran__markers_1_1ScoreMarkersPairwiseOptions_html"><div class="ttname"><a href="structscran__markers_1_1ScoreMarkersPairwiseOptions.html">scran_markers::ScoreMarkersPairwiseOptions</a></div><div class="ttdoc">Options for score_markers_pairwise() and friends.</div><div class="ttdef"><b>Definition</b> score_markers_pairwise.hpp:30</div></div>
</div><!-- fragment --><p>Alternatively, if we already have an array effect sizes, we can use the <code>summarize_effects()</code> function to obtain summaries for each group. In fact, <code>score_markers_summary()</code> is just a more memory-efficient version of <code>score_markers_pairwise()</code> followed by <code>summarize_effects()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> cohen_summary = <a class="code hl_function" href="namespacescran__markers.html#aefddf4357cc7de227c5242b3861d5a27">scran_markers::summarize_effects</a>(</div>
<div class="line">    matrix.nrows(),</div>
<div class="line">    pair_res.mean.size(), <span class="comment">// i.e., number of groups</span></div>
<div class="line">    pair_res.cohens_d.data()</div>
<div class="line">);</div>
<div class="ttc" id="anamespacescran__markers_html_aefddf4357cc7de227c5242b3861d5a27"><div class="ttname"><a href="namespacescran__markers.html#aefddf4357cc7de227c5242b3861d5a27">scran_markers::summarize_effects</a></div><div class="ttdeci">void summarize_effects(const Gene_ ngenes, const std::size_t ngroups, const Stat_ *const effects, const std::vector&lt; SummaryBuffers&lt; Stat_, Rank_ &gt; &gt; &amp;summaries, const SummarizeEffectsOptions &amp;options)</div><div class="ttdef"><b>Definition</b> summarize_effects.hpp:123</div></div>
</div><!-- fragment --><p>Check out the <a href="https://libscran.github.io/scran_markers">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  scran_markers</div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/scran_markers</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(scran_markers)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespacescran__markers.html" title="Marker detection for single-cell data.">scran_markers</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe libscran::scran_markers)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::scran_markers)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
CMake with <code>find_package()</code></h2>
<div class="fragment"><div class="line">find_package(libscran_scran_markers CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::scran_markers)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DSCRAN_MARKERS_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. If you want to install them manually, use <code>-DSCRAN_MARKERS_FETCH_EXTERN=OFF</code>. See the tags in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> to find compatible versions of each dependency.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This also requires the external dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
